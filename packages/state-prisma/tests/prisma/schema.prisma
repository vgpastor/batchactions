generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model BatchactionsJob {
  id           String  @id
  status       String
  config       String  // SQLite: Json stored as TEXT
  batches      String  @default("[]")
  totalRecords Int     @default(0)
  startedAt    BigInt?
  completedAt  BigInt?
  distributed  Boolean @default(false)

  @@map("batchactions_jobs")
}

model BatchactionsRecord {
  id              Int     @id @default(autoincrement())
  jobId           String
  batchId         String
  recordIndex     Int
  status          String
  raw             String  // SQLite: Json stored as TEXT
  parsed          String  // SQLite: Json stored as TEXT
  errors          String  @default("[]")
  processingError String?

  @@unique([jobId, recordIndex])
  @@index([jobId, status])
  @@index([jobId, batchId])
  @@map("batchactions_records")
}

model BatchactionsBatch {
  id               String  @id
  jobId            String
  batchIndex       Int
  status           String  @default("PENDING")
  workerId         String?
  claimedAt        BigInt?
  recordStartIndex Int     @default(0)
  recordEndIndex   Int     @default(0)
  processedCount   Int     @default(0)
  failedCount      Int     @default(0)
  version          Int     @default(0)

  @@unique([jobId, batchIndex])
  @@index([jobId, status])
  @@map("batchactions_batches")
}
